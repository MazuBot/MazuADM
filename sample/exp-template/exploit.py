#!/usr/bin/env python3
import re
import sys

import httpx

from lib import Target, get_target


def main() -> int:
    target = get_target(sys.argv)

    base = f"http://{target.host}:{target.port}"

    try:
        with httpx.Client(timeout=5.0, follow_redirects=True) as client:
            resp = client.get(f"{base}/")
            resp.raise_for_status()
    except Exception as exc:
        print(f"[!] request failed: {exc}", file=sys.stderr)
        return 1

    text = resp.text.strip()
    match = re.search(r"FLAG\\{[^}]+\\}", text)
    if not match:
        print(text)
        return 3

    print(match.group(0))
    return 0


if __name__ == "__main__":
    raise SystemExit(main())
